author: wangyadi

### 一、LTV的定义与作用。

#### A：LTV的定义与特点。

* LTV定义:

> 顾客终生价值(CLV: Customer Lifetime Value) 或称(LTV: Lifetime Value) ,指的是每个用户从使用服务到最终放弃使用该服务期间，为该服务带来的收益总和。



&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LTV的计算有两个特点，一个是**预测**，一个是**群体**.

* 预测:

> 这个定义可以看出，LTV关注的是用户的整个生命周期内的价值。但实际场景中，用户最终放弃时间是未知的且具有不确定性的，因此，LTV往往是以预测的形式出现，我们会根据用户历史某段时间的表现，去预测用户的终身价值。LTV是一个预测逻辑产生的结果。  

* 群体:

> LTV是一个数据指标，主要用于评估用户质量的好坏。若用于评估单个用户的价值，其实意义并不大，且预测的准确率会比较低，因此当用于评估用户群体之间的差异时，得出的数据才具有普遍性。基于群体数据计算得出的LTV更具有参考价值与实用性。

#### B：LTV的作用。

* 直观作用:

> 单独看LTV这个指标的话，他主要用来评估用户质量的好坏（商业价值的高低）。场景一：计算不同渠道的LTV，来决定渠道的投放配比，选择满足当前业务需要的最优解。场景二：对比某产品方案实施前后的用户价值变化情况，判断新功能的实际价值有多大。



* 延伸作用:

> 计算ROI，预估成本回收期等。ROI：ROI=利润/成本=LTV/CCA，计算LTV是计算ROI的前提。预估成本回收期：LTV的时间曲线与投入成本线的交点就是成本回收期。LTV评价的是利润的绝对值，ROI评价的是资本的使用效率，成本回收期评价的是资本的周转速度。ROI、LTV与成本回收期都是促进决策的重要指标，这三个指标往往组合使用，但在不同的场景下三者的重要程度略有不同。





### 二、LTV的计算逻辑。



&nbsp;&nbsp;&nbsp;&nbsp;不同的精准程度与计算效率的要求，LTV的计算方法也不尽相同（[其他计算逻辑](https://note.wiz.cn/web?dc=29171e20-707b-11e9-840e-af72eef1e823&cmd=kw%2C&kb=20a58ec0-707b-11e9-b908-97082e252d28))。我们采用的计算逻辑为:

> $$LTV = \sum_{t=1}^n (ARPU_{t}-MC_{t})Reten_{t} - CCA $$





##### A：术语说明。



* LT

> 生命周期(Lifetime)， 一个用户从第1次到最后1次使用产品之间的时间差，一般以天为单位。

* ARPU

> 每用户平均收入（Average Revenue Per User，简称ARPU), 一个时间段内平均每个用户给公司带来的收入, 通常可以用N天内单位用户带来的日均收入表示。

* MC (`本文自定义术语`)

> 维护成本(Maintenance Cost), 针对激励型的用户产品，用户是可以从该产品直接获取金钱收益的，这里的维护成本指的是发给每个用户的金钱(或转换后的金钱替代物)。 并未包含其他成本如(服务器成本，人力资源成本等)。 

* CCA (`本文自定义术语`)

> 获客成本(CostofCustomerAcquisition)，获取一个新用户需要花费的金钱，比如推广成本，邀请成本等。



#####B：案例说明。



&nbsp;&nbsp;&nbsp;&nbsp;接下来以一个具体的例子来说明一下这个公式，下图是某个产品04-19到04-25日7天的新增留存梯度数据，接下来以此图来说明LTV的计算逻辑。

![](http://pcmyp.oss-cn-beijing.aliyuncs.com/markdown/2019-04-26-024809.jpg?x-oss-process=image/resize,h_450,w_650)

1. 公式中的 $n$ 从数学的角度讲应该是$+\infty$, 但是在实际中我们会定义一个值，比如1000(根据我们产品，认为用户在产品内最多留存1000天)。

2. $Reten_{t}$ 表示第$t$ 天的留存率，这个在图中就是`第一行数据，第一日到第七日的留存率`数据，即31.78% 32.41% 等。这里要理解这个数据是如何计算出来的，拿第一日流程率$ 31.78\%$举例。 $ 31.78\% = \frac{ 41=(第一日这一列所有人之和)}{129=(当日这一列所有人之和)} $ ,其他剩余六日日以此类推。 至此，`我们根据已有数据得到了7日的留存率`，这还不够，我们需要得到$n$日的留存,这时我们就要做一个回归拟合，一般我们选择幂函数加常数项作为目标函数,即 $y = ax^b+c$ ，根据已知7日数据，求解$a,b,c$ ,对于求解Python，Excel等都可以做，这里不做赘述，如有需要放到求解篇讲解。一旦求解出$a,b,c$, 我们我就可以求得任意$Reten_{t}$. 另说明一下一批用户的留存率之和即为这批用户的LT。

3. $ARPU_{t}$ 表示第$t$的平均ARPU值，为了说明这一项，我先定义第一日留存的人，即图中$41(人)$商业收入为M1，一次到第七日是M7,这些值(M1~M7)都是已发生的数据是可以计算的,各家的商业模式不一样，计算方式也会不同，但是`总之就是要计算出这七日每日留存的人带来的收入M1~M7`。对于第一日APRU，计算是这样的，$ ARPU_{1} = \frac{M1}{41}$，至此，我们就可以计算第一日到第七日的ARPU。这还不够，我们需要求得$n$日ARPU，如何计算呢，同LT一样，我们拟合一个函数，来计算ARPU，这和LT的拟合是一样的，这里不再赘述。 另外需要说明的是，对于APPU我们也可以不通过拟合的方式计算，而是已加权平均的方式计算，对于已发生的ARPU我们求得一个加权平均值，对于未发生的ARPU，我们取最近几天已知的ARPU算加权平均作为未发生的ARPU，这样就不用拟合函数了，也带来了计算上的变量，误差也在可控范围之内(具体在不在要根据各家公司产品的实际数据情况验证)。

4. 对于$MC_{t}$ ,其计算逻辑和$ARPU_{t}$ 一致，不再赘述。 有的产品可能没有维护成本，我们是有的，产品特点是为注意力付费，我们的用户每天发生看新闻、做任务等行为后，都会收到一定的金币奖励，这些金币可以直接折算成人民币提现，这些成本构成了用户的每日维护成本。

5. 对于$CCA$ ，获客成本，是一个定值，即这批用户，即图中128(人)，需要多少成本来获取，根据你当前公司的情况来定。对我们而言主要包含注册成本、邀请成本、推广成本。注册成本是新用户注册后给的一次性奖励，邀请成本指支付给师父的成本，推广成本是在各大应用市场渠道投放的成本。获客成本的计算比较简单，难点在于数据的采集以及如何将成本归因到相应的渠道或用户组中。

##### C：LTV的近似计算。

* 在计算LTV的过程中，根据我们的业务形态，我们采用近似计算的方式

> $ LTV = \sum_{t=1}^m Reten_{t} * \frac{ \sum_{t=1}^m M{t} }{\sum_{t=1}^mU_{t}} -  \sum_{t=1}^m Reten_{t}*MC_{mavg}  +  \sum_{t=m}^n Reten_{t} * \frac{ \sum_{t=k}^m M{t} }{\sum_{t=k}^mU_{t}}  -  \sum_{t=m}^n Reten_{t} * MC_{pavg} - CCA$ 

* 化简后的公式

> $ LTV = \sum_{t=1}^m Reten_{t}* (\frac{ \sum_{t=1}^m M{t} }{\sum_{t=1}^mU_{t}}-MC_{mavg} ) + \sum_{t=m}^n Reten_{t} *( \frac{ \sum_{t=k}^m M{t} }{\sum_{t=k}^mU_{t}} -MC_{pavg}) - CCA$

* 说明

1. $\sum_{t=1}^m Reten_{t}$ 代表`已发生`的LT, 即已知数据的的LT，$m$就代表着已知数据的天数，例如上图的7天，此时m=7。

2. $\frac{ \sum_{t=1}^m M{t} }{\sum_{t=1}^mU_{t}}$ 代表`已发生`的平均ARPU，也是已知数据的那些天计算出来的天平均ARPU ，$M_{t}$代表第t天的收入，对应我上文说的M1~M7。$U_{t}$ 代表第t天的留存用户数，累加其实就是表示已知数据的总活跃用户数，即要计算LTV的这批用户数。$MC_{mavg}$ 表示平均每日维护成本，计算逻辑和ARPU一样

3. $\sum_{t=m}^n Reten_{t}$ 代表`未发生`的LT, 即已知数据的的LT，$n$就代表着未数据的天，比如我们使用$n=1000$。
4. $\frac{ \sum_{t=k}^m M{t} }{\sum_{t=k}^mU_{t}}$ 代表`未发生`的ARPU，$k$ 表示已知数据的最近k天，即 $m-k$ 这些天已知数据计算的的平均ARPU，作为未知ARPU，不再使用曲线拟合ARPU。

5. $MC_{pavg}$ 表示`未发生`的平均每日维护成本，计算逻辑和未发生ARPU一样。

6. $CCA $ 获客成本。    



### 三、LTV的实现逻辑。

#### A：数据结构设计。



* 设计原则：通用性原则。

> LTV本质的计算逻辑实际上大同小异，差异点在于不同的业务场景下，ARPU与MC的计算逻辑千差万别。因此，我们在做数据表的时候，只设计两张主表用于记录必要的信息：留存表和收支表（见下图），交给业务方来维护即可。业务方可以根据业务实际情况，更新这两张表。



* 留存表：

![WechatIMG12](/Users/yadi/Desktop/WechatIMG12.png)

​    更新规则：

​    1、每日更新前一天的数据，定时更新。  

​    2、全量更新。



* 收支表：

![WechatIMG13](/Users/yadi/Desktop/WechatIMG13.png)

​    更新规则：

​    1、每日更新前一天的数据，定时更新。

​    2、只更新有收入或支出数据的行。



#### B：实现问题解析。



* python 与 Excel 实现结果差异问题。

> 一般业务人员在做幂函数拟合的时候，比较常用的工具是Excel，但是我们用python做代码实现的时候，发现相同的数据在Excel中和python中拟合出的函数有些差别。这个主要原因是python和Excel在拟合的时候内置函数策略有所不同。

